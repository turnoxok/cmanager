<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulta de CUIT en BCRA</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, button { padding: 8px; font-size: 16px; margin-top: 5px; }
    #resultado { margin-top: 20px; white-space: pre-wrap; }
    .error { color: red; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>

  <h2>Consulta de CUIT en BCRA</h2>
  <label for="cuit">Ingrese su CUIT:</label><br>
  <input type="text" id="cuit" placeholder="20-12345678-9">
  <button id="consultar">Consultar</button>

  <div id="resultado"></div>

  <script>
    const boton = document.getElementById('consultar');
    const resultado = document.getElementById('resultado');

    boton.addEventListener('click', () => {
      // Limpiar CUIT: quitar guiones y espacios
      const cuitRaw = document.getElementById('cuit').value.trim();
      const cuit = cuitRaw.replace(/[^0-9]/g, '');

      if (cuit.length !== 11) {
        resultado.innerHTML = '<span class="error">CUIT inválido. Debe tener 11 dígitos numéricos.</span>';
        return;
      }

      resultado.textContent = 'Consultando...';

      fetch(`https://api.bcra.gob.ar/centraldedeudores/v1.0/Deudas/${cuit}`)
        .then(response => {
          if (!response.ok) throw new Error('Error en la consulta');
          return response.json();
        })
        .then(data => {
          // Revisar si existe el array de deudas
          const deudas = data?.Deudas || []; // Ajustar según la estructura real
          if (deudas.length === 0) {
            resultado.textContent = 'No hay registros de deudas para este CUIT.';
            return;
          }

          // Crear tabla de resultados
          let tabla = '<table><tr><th>Entidad</th><th>Monto Total</th><th>Días de atraso</th><th>Estado</th></tr>';
          deudas.forEach(item => {
            tabla += `<tr>
                        <td>${item.Entidad || '-'}</td>
                        <td>${item.MontoTotal || '-'}</td>
                        <td>${item.DiasAtraso || '-'}</td>
                        <td>${item.Estado || '-'}</td>
                      </tr>`;
          });
          tabla += '</table>';
          resultado.innerHTML = tabla;
        })
        .catch(error => {
          console.error(error);
          resultado.innerHTML = '<span class="error">Error al consultar el BCRA. Intente nuevamente.</span>';
        });
    });
  </script>

</body>
</html>
